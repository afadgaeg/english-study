<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <title>sport</title>
    <style type="">
        * {
            box-sizing: border-box;
            font-size:40px;
        }

        body {
            width:100%;
            margin:0 auto;
            max-width:900px;
            padding: 0 10px;
        }

        select, button{
            width:100%;
            height:130px;
            margin-top:50px;
        }

        div#bottom{
            position: fixed;
            bottom: 65px;
            width: 100%;
            max-width:900px;
            margin:0 auto;
            height: 130px;
            line-height: 130px;
        }

    </style>
    <script>
        let synth = window.speechSynthesis;
        let voices = synth.getVoices();
        let u = new SpeechSynthesisUtterance();
        u.lang = 'zh-CN';
        u.rate = 1;
        u.voice = voices[0];
        let ii = -1;
        let ps = new Array();
        function speak($p) {
            synth.cancel();
            u.text = $p.text();
            synth.speak(u);
            $(window).scrollTop($p.position().top);
        }
        u.onend = function(event){
            if(ii==-1){
                return;
            }
            ii++;
            if(ii>=ps.length){
                return;
            }
            speak(ps[ii]);
        };
        $(document).ready(function(){
            $("#stop").click(function(){
                ii = -1;
                synth.cancel();
            });

            $.ajax({
                type: "get",
                url: "sport.txt",
                dataType: "text",
                async: true
            }).done(function (initText) {
                let ss = new Array();
                let ss_ = initText.split(/[\n]{1}/);
                for( let s of ss_){
                    s = s.trim();
                    if(s.length==0){
                        continue;
                    }
                    ss.push(s);
                }

                for(let i in ss){
                    let $s = $("<p>"+ss[i]+"</p>");
                    ps.push($s);
                    $("#sport").append($s);
                    $s.click(function() {
                        ii = i;
                        speak($(this));
                    });
                }
            });
        });

    </script>
</head>
<body>
<div id="main">
    <div id="sport">
    </div>
    <div id="bottom">
        <button id="stop">Stop</button>
    </div>
</div>

</body>
</html>


