<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <title>english listen</title>
    <style type="">
        * {
            box-sizing: border-box;
            font-size:40px;
        }

        body {
            width:100%;
            margin:0 auto;
            max-width:900px;
            padding: 0 10px;
        }

        select, button{
            width:100%;
            height:130px;
            margin-top:50px;
        }

    </style>
    <script>
        // https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/cancel
        let synth = window.speechSynthesis;
        let voices = synth.getVoices();
        let u = new SpeechSynthesisUtterance();
        u.lang = 'zh-CN';
        u.rate = 1;
        u.voice = voices[0];

        function speak(textToSpeak) {
            u.text = textToSpeak;
            synth.speak(u);
        }

        $(document).ready(function(){
            for (let i = 0; i < voices.length; i++) {
                let option = "<option value=" + i + ">" + voices[i].name + "</option>";
                $("#voices").append(option);
            }
            $("#voices").change(function(){
                let i = $(this).val();
                u.voice = voices[i];
            });


                //synth.cancel();

            $.ajax({
                type: "get",
                url: "sport.txt",
                dataType: "text",
                async: true
            }).done(function (initText) {
                strs = [];
                let ss = initText.split(/[\n]{2}/);
                for(let i = 0; i< ss.length; i++ ){
                    let l = ss[i].trim();
                    if(l.length==0){
                        continue;
                    }
                    let $s = $("<div><p>"+l+"</p></div>");
                    let $b = $("<button>Play</button>");
                    $s.append($b);
                    $("#sport").append($s);
                    $b.click(function() {
                        let txt = $(this).prev().text();
                        speak(txt);
                    });
                }
            });

        });

    </script>
</head>
<body>
<div>
    <div>
        <select id="voices"></select>
    </div>
    <div id="sport">

    </div>
</div>

</body>
</html>


