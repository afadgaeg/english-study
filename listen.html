<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <title>english listen</title>
    <style type="">
        body {
            width:800px;
            margin:15px auto;
        }
        #inittext{
            width:800px;
            height:300px;
        }
        #number{
            background-color: #DDD;
            margin-top:15px;
        }
        #showtext{
            width:800px;
            height:130px;
            background-color: lightblue;
            margin-bottom:15px;
        }
        #player{
            margin-top:10px;
        }
        #initdiv{
            margin-top:10px;
        }
        #info{
            margin-top:10px;
            background-color: #EEE;
            width:800px;
        }



    </style>
    <script>
        // https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/cancel
        let synth = window.speechSynthesis
        let u = new SpeechSynthesisUtterance();
        u.lang = 'en-US';
        u.rate = 1;
        let strs = [];
        let ii=0;

        function speak(textToSpeak) {
            u.text = textToSpeak;
            synth.speak(u);
        }
        function select(number){
            ii = number;
            $("#number").html("Sentence " + ii);
            $("#en").html("");
            $("#zh").html("");
        }
        function random() {
          return Math.floor(Math.random() * strs.length);
        }

        $(document).ready(function(){
            $("#init").click(function() {
                strs = [];
                let initText = $("#inittext").val();
                let str = {};
                let ss = initText.split(/[\n]/);
                for(let i = 0; i< ss.length; i++ ){
                    let l = ss[i].trim();
                    if(l.length==0){
                        continue;
                    }
                    if($.isEmptyObject(str)){
                        str = {en:l}
                    } else{
                        str.zh = l;
                        strs.push(str);
                        str = {};
                    }
                }
                $("#inittext").val("");
            });
            $("#next").click(function() {
                let i = ii +1 ;
                if(i>=strs.length){
                    i=0;
                }
                select(i);
            });

            $("#previous").click(function() {
                let i = ii -1 ;
                if(i<0){
                    i=strs.length-1;
                }
                select(i);
            });
            $("#random").click(function() {
                select(random());
            });

            $("#show").click(function() {
                $("#en").html(strs[ii].en);
                $("#zh").html(strs[ii].zh);
            });
            $("#a").click(function() {
                speak(strs[ii].en);
            });
            $("#b").click(function() {
                synth.pause();
            });
            $("#c").click(function() {
                synth.resume();
            });
            $("#d").click(function() {
                synth.cancel();
            });


            select(0);
        });




    </script>
</head>
<body>

<div>
    <textarea id="inittext"></textarea>
</div>
<div id="initdiv">
    <button id="init">Init</button>
</div>

<div id="number"></div>
<div id="showtext">
    <div id="en"></div>
    <div id="zh"></div>
</div>

<div>
    <div>
        <button id="next">Next</button>
        <button id="previous">Previous</button>
        <button id="random">Random</button>
        <button id="show">Show</button>
    </div>

    <div id="player">
        <button id="a">Play</button>
        <button id="b">Pause</button>
        <button id="c">Continue</button>
        <button id="d">Stop</button>
    </div>
</div>

<div id="info">
    <p>简介</p>
    <p>辅助训练英语听力，火狐或者Chrome测试可用</p>
    <p>使用说明</p>
    <p>
    <ul>
        <li>将符合格式（空行会被忽略，忽略空行后的文本只需严格保证一行英文后接一行中文即可）的听力材料文本粘贴进顶部文本框，然后点init进行初始化，然后就可以练听力了</li>
        <li>点Random随机选句子，next和previous顺序选句子</li>
        <li>点show显示当前句子的中英文</li>
        <li>play pause continue stop 控制英语发音</li>
    </ul>
    </p>
</div>

</body>
</html>


